function D(){return Math.abs((Math.random()+Math.random()+Math.random()+Math.random()+Math.random()+Math.random()-3)/3)}function G(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}function p(e,t,n,a){let r=[],s=n.split(" "),o="",c="",h=0,b=1.4;return s.forEach(f=>{c=o+f+" ",e.measureText(c).width>a?(h=(r.length+1)*t*b,r.push({text:o,height:h}),o=f+" "):o=c}),o.length>0&&(h=(r.length+1)*t*b,r.push({text:o.trim(),height:h})),r}function U(){let e=1080/window.innerHeight,t=1780/window.innerWidth;return Math.min(e,t)}document.body.style.position="fixed";document.body.style.margin=0;document.body.style.font="12px Montserrat";var A=document.createElement("canvas"),k=document.createElement("canvas"),H=document.createElement("canvas"),R=[A,k,H],C=new Image,F=new Image,P=new Image;C.src="./assets/bg_back_32.png";F.src="./assets/bg_mid_32.png";P.src="./assets/bg_fore_32.png";var u=new Audio("./assets/ori_main_theme.mp3"),I=new Image,q=new Image,S=new Image,w=new Image,v=new Image,l=new Image,B=new Image;I.src="./assets/logo1.png";q.src="./assets/raster.png";S.src="./assets/click.svg";w.src="./assets/volumeUp.svg";v.src="./assets/volumeOff.svg";l.src="./assets/fullscreen.svg";B.src="./assets/fullscreenExit.svg";var _=A.getContext("2d",{alpha:!1}),g=k.getContext("2d"),i=H.getContext("2d"),Z=1e3,ee="Main Theme - Definitive Edition",te="Gareth Coker",ne="Ori and the Blind Forest",E=0,O=0,d,x=0,L=0,M=1,N=!1,y=1,ie=Math.floor(window.innerHeight*window.innerWidth/4e4),m=new Array(ie);m.fill({});m=m.map(e=>({x:Math.floor(Math.random()*window.innerWidth),y:Math.floor(Math.random()*window.innerHeight),r:Math.floor(D()*100+6),angle:Math.random()*360}));var oe=e=>{e.forEach((t,n)=>{t.style.position="absolute",t.style.top=0,t.style.left=0,t.style.zIndex=n})},$=e=>{e.forEach(t=>{t.width=window.innerWidth,t.height=window.innerHeight})},V=e=>{let{beta:t,gamma:n}=e;n>45?n=45:n<-45&&(n=-45),t>45?t=45:t<-45&&(t=-45),window.innerHeight>window.innerWidth?x=n:x=t},X=()=>{y=U()},Y=e=>{ae(),re(),L&&M&&T(e),window.requestAnimationFrame(Y)},se=()=>{m=m.map((e,t)=>{e.angle+=.01,e.y-=.02*e.r;let n=Math.sin(e.angle)/4*(e.r/20);return e.x+=n,e.x>window.innerWidth+e.r*2||e.x<-e.r*2||e.y<-e.r*2?t%3>0?{x:Math.random()*window.innerWidth,y:window.innerHeight+e.r*2,r:e.r,angle:e.angle}:n>0?{x:-e.r*2+1,y:Math.random()*window.innerHeight,r:e.r,angle:e.angle}:{x:window.innerWidth+e.r*2-1,y:Math.random()*window.innerHeight,r:e.r,angle:e.angle}:e})},de=()=>{se(),m.forEach(e=>{let t=g.createRadialGradient(e.x,e.y,0,e.x,e.y,e.r),n=Math.sqrt((e.x-E)*(e.x-E)+(e.y-O)*(e.y-O));n>100?(t.addColorStop(0,"rgba(255,255,164,.7)"),t.addColorStop(.4,"rgba(247,148,29,.3)"),t.addColorStop(1,"rgba(255,218,164,0)")):(t.addColorStop(0,`rgba(255,255,164,${.7+.3*(100-n)/100})`),t.addColorStop(.4,`rgba(247,148,29,${.3+.4*(100-n)/100})`),t.addColorStop(1,"rgba(255,218,164,0)")),g.fillStyle=t,g.fillRect(e.x-e.r,e.y-e.r,e.r*2,e.r*2)})},le=()=>{window.innerWidth>1599?d.fftSize=2048:window.innerWidth<600?d.fftSize=512:d.fftSize=1024;let e=d.frequencyBinCount,t=new Uint8Array(e);d.getByteFrequencyData(t);let n=window.innerWidth/e,a,r=0;g.fillStyle="rgba(255, 255, 255,.5)";for(let s=0;s<e;s++)a=t[s],g.fillRect(r,window.innerHeight-a,n,a),r+=n+1},ce=()=>{let e=window.innerWidth-40,t=Math.min(36,window.innerHeight/12),n=ee;i.font=`${t}px Montserrat`,i.fillStyle="white",i.textAlign="center";let a=p(i,t,n,e),r=0,s=0;a.forEach(o=>{s=o.height,i.fillText(o.text.trim(),window.innerWidth/2,window.innerHeight*.65+r+s)}),r+=s+4,t=Math.min(27,window.innerHeight/12*.75),i.font=`${t}px Montserrat`,n=ne,a=p(i,t,n,e),a.forEach(o=>{s=o.height,i.fillText(o.text,window.innerWidth/2,window.innerHeight*.65+r+s)}),r+=s+4,n=te,i.font=`bold ${t}px Montserrat`,a=p(i,t,n,e),a.forEach(o=>{s=o.height,i.fillText(o.text,window.innerWidth/2,window.innerHeight*.65+r+s)})},ae=()=>{let e=Math.ceil(C.naturalWidth/y),t=Math.ceil(C.naturalHeight/y),n=(window.innerWidth-e)/2,a=Math.ceil((window.innerHeight-t)/2);_.drawImage(C,Math.ceil(n-x*.3),a,e,t),_.drawImage(F,Math.ceil(n+x*.2),a,e,t),_.drawImage(P,Math.ceil(n+x*.7),a,e,t)},re=()=>{g.clearRect(0,0,window.innerWidth,window.innerHeight),de(),d&&le()},T=e=>{i.clearRect(0,0,window.innerWidth,window.innerHeight);let t=y+.5,n=I.naturalWidth/t,a=I.naturalHeight/t,r=(window.innerWidth-n)/2,s=-50/t;i.drawImage(I,r,s,n,a);let o=Math.max(window.innerWidth,window.innerHeight)/2;i.save();let c=i.createRadialGradient(o,o,0,o,o,o*1.4);c.addColorStop(0,"transparent"),c.addColorStop(.7,"transparent"),c.addColorStop(.95,"black"),c.addColorStop(1,"black"),i.fillStyle=c;let h=window.innerHeight/window.innerWidth,b=window.innerWidth/window.innerHeight;i.setTransform(Math.min(1,b),0,0,Math.min(1,h),0,0),i.fillRect(0,0,o*2,o*2),i.restore();let f=y+1,z=S.naturalWidth/f,j=S.naturalHeight/f,J=(window.innerWidth-z)/2-5,K=window.innerHeight*.86;if(e){let W=(e-L)/Z;if(W<0)return;W>1?(W=1,M=0):M=1-G(W)}i.save(),i.globalAlpha=M,i.drawImage(S,Math.ceil(J),Math.ceil(K),Math.ceil(z),Math.ceil(j)),i.restore(),i.save(),i.globalAlpha=1-M,ce(),u.muted?i.drawImage(v,24,24,v.width,v.height):i.drawImage(w,24,24,w.width,w.height),i.restore(),document.fullscreenElement?i.drawImage(B,window.innerWidth-l.width-16,16,l.width,l.height):i.drawImage(l,window.innerWidth-l.width-16,16,l.width,l.height),i.save();let Q=i.createPattern(q,"repeat");i.fillStyle=Q,i.globalAlpha=.5,i.fillRect(0,0,window.innerWidth,window.innerHeight),i.restore()},he=()=>{L=performance.now();let e=u.play();e&&e.then(t=>{N=!0;let n=new(window.AudioContext||window.webkitAudioContext);d=n.createAnalyser(),d.minDecibels=-110,d.maxDecibels=-30,d.smoothingTimeConstant=.88,n.createMediaElementSource(u).connect(d),d.connect(n.destination)}).catch(t=>{console.log(t)})},we=e=>{let{clientX:t,clientY:n}=e;window.innerWidth-l.width-16<t&&t<window.innerWidth-16&&n>16&&n<16+l.height?document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen():16<t&&t<16+w.width&&16<n&&n<16+w.height?(console.log("VOLUME"),u.muted=!u.muted,T()):N||he()};window.onload=()=>{document.body.appendChild(A),document.body.appendChild(k),document.body.appendChild(H),document.fonts.ready.then(function(){T()}),H.addEventListener("click",we),window.addEventListener("resize",()=>{$(R),X(),T()}),navigator.maxTouchPoints?window.addEventListener("deviceorientation",V):window.addEventListener("mousemove",e=>{E=e.x,O=e.y;let t=E*100/window.innerWidth-50;V({beta:t,gamma:t})}),oe(R),$(R),X(),Y()};
