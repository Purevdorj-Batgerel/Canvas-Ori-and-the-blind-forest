(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();class l{constructor(t){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d",t)}clear(){this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight)}draw(){throw new Error("Must be implemented by subclass!")}}class W{constructor(...t){if(this.canvases=t.filter(e=>e instanceof l),this.canvases.length!==t.length)throw new Error("Invalid input: One or more arguments are not Canvas objects.");for(const e of this.canvases)e.canvas.style.position="absolute",e.canvas.style.top=0,e.canvas.style.left=0,e.canvas.style.zIndex=this.canvases.indexOf(e);this.resizeCanvases()}getCanvasElements(){return this.canvases.map(t=>t.canvas)}appendToDom(){for(const t of this.getCanvasElements())document.body.appendChild(t)}draw(){for(const t of this.canvases)t.draw()}resizeCanvases(){for(const t of this.getCanvasElements())t.width=window.innerWidth,t.height=window.innerHeight}}class z{constructor(){this.audio=new Audio("./ori_main_theme.mp3"),this.isSoundInitialized=!1,this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioCtx.createAnalyser(),this.analyser.minDecibels=-110,this.analyser.maxDecibels=-30,this.analyser.smoothingTimeConstant=.88}async playAudio(){await this.audio.play(),await this.audioCtx.resume(),this.isSoundInitialized=!0,this.audioCtx.createMediaElementSource(this.audio).connect(this.analyser),this.analyser.connect(this.audioCtx.destination)}isMuted(){return this.audio.muted}toggleMute(){this.audio.muted=!this.audio.muted}}const x=60,M=48;class E{constructor(){this.tiltAngle=0,this.mouseX=0,this.mouseY=0,this.handleMouseMove=this.handleMouseMove.bind(this),this.handleDeviceOrientation=this.handleDeviceOrientation.bind(this),this.handleClick=this.handleClick.bind(this)}handleDeviceOrientation(t){let{beta:e,gamma:i}=t;i>45?i=45:i<-45&&(i=-45),e>45?e=45:e<-45&&(e=-45),window.innerHeight>window.innerWidth?this.tiltAngle=i:this.tiltAngle=e}handleMouseMove(t){this.mouseX=t.x,this.mouseY=t.y;const e=this.mouseX*100/window.innerWidth-50;this.handleDeviceOrientation({beta:e,gamma:e})}handleClick(t){const{clientX:e,clientY:i}=t;window.innerWidth-x-16<e&&e<window.innerWidth-16&&i>16&&i<16+x?document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen():16<e&&e<16+M&&16<i&&i<16+M?c.toggleMute():c.isSoundInitialized||(c.playAudio(),A(performance.now()))}}function p(a,t){return[()=>a,n=>{t&&typeof t=="function"?a=t():a=n}]}function _(){return Math.abs((Math.random()+Math.random()+Math.random()+Math.random()+Math.random()+Math.random()-3)/3)}function b(){const a=1080/window.innerHeight,t=1780/window.innerWidth;return Math.min(a,t)}const[y,A]=p(0),[w,L]=p(b(),b),c=new z,h=new E;class O extends l{constructor(){super({alpha:!1}),this.bg_back=new Image,this.bg_mid=new Image,this.bg_fore=new Image,this.bg_back.src="./bg_back_32.webp",this.bg_mid.src="./bg_mid_64.webp",this.bg_fore.src="./bg_fore_32.webp"}draw(){const t=Math.ceil(this.bg_back.naturalWidth/w()),e=Math.ceil(this.bg_back.naturalHeight/w()),i=(window.innerWidth-t)/2,n=Math.ceil((window.innerHeight-e)/2);this.ctx.drawImage(this.bg_back,Math.ceil(i-h.tiltAngle*.3),n,t,e),this.ctx.drawImage(this.bg_mid,Math.ceil(i+h.tiltAngle*.2),n,t,e),this.ctx.drawImage(this.bg_fore,Math.ceil(i+h.tiltAngle*.7),n,t,e)}}class D extends l{constructor(){super();const t=Math.floor(window.innerHeight*window.innerWidth/4e4);this.wisps=new Array(t);for(let e=0;e<t;e++)this.wisps.push({x:Math.floor(Math.random()*window.innerWidth),y:Math.floor(Math.random()*window.innerHeight),radius:Math.floor(_()*100+6),angle:Math.random()*360})}update(){this.wisps.forEach((t,e)=>{const i=Math.sin(t.angle)*t.radius/100;t.angle+=.01,t.y-=.02*t.radius,t.x+=i,(t.x>window.innerWidth+t.radius*2||t.x<-t.radius*2||t.y<-t.radius*2)&&(e%3?(t.x=Math.random()*window.innerWidth,t.y=window.innerHeight+t.radius*2):i>0?(t.x=-t.radius*2+1,t.y=Math.random()*window.innerHeight):(t.x=window.innerWidth+t.radius*2-1,t.y=Math.random()*window.innerHeight))})}draw(){this.clear(),this.update();const{mouseX:t,mouseY:e}=h;for(const i of this.wisps)if(i){const n=this.ctx.createRadialGradient(i.x,i.y,0,i.x,i.y,i.radius),s=Math.sqrt((i.x-t)*(i.x-t)+(i.y-e)*(i.y-e));s>100?(n.addColorStop(0,"rgba(255,255,164,.7)"),n.addColorStop(.4,"rgba(247,148,29,.3)"),n.addColorStop(1,"rgba(255,218,164,0)")):(n.addColorStop(0,`rgba(255,255,164,${.7+.3*(100-s)/100})`),n.addColorStop(.4,`rgba(247,148,29,${.3+.4*(100-s)/100})`),n.addColorStop(1,"rgba(255,218,164,0)")),this.ctx.fillStyle=n,this.ctx.fillRect(i.x-i.radius,i.y-i.radius,i.radius*2,i.radius*2)}}}class P extends l{constructor(t){super(),this.analyser=t}draw(){this.clear(),window.innerWidth>1599?this.analyser.fftSize=2048:window.innerWidth<600?this.analyser.fftSize=512:this.analyser.fftSize=1024;const t=this.analyser.frequencyBinCount,e=new Uint8Array(t);this.analyser.getByteFrequencyData(e);const i=window.innerWidth/t;let n,s=0;this.ctx.fillStyle="rgba(255, 255, 255,.5)";for(let o=0;o<t;o++)n=e[o],this.ctx.fillRect(s,window.innerHeight-n,i,n),s+=i+1}}function V(a){if(typeof a!="number"||a<0||a>1)throw new Error("Invalid input: input must be a number between 0 and 1.");return a<.5?2*a*a:1-(-2*a+2)**2/2}const T=1e3,R=60,F="Main Theme - Definitive Edition",N="Gareth Coker",k="Ori and the Blind Forest";function u(a,t,e,i){const n=[],s=e.split(" ");let o="",r=0;const g=1.4;for(const m of s){const v=`${o}${m} `;a.measureText(v).width>i?(r=(n.length+1)*t*g,n.push({text:o,height:r}),o=`${m} `):o=v}return o.length>0&&(r=(n.length+1)*t*g,n.push({text:o.trim(),height:r})),n}class G extends l{constructor(){super(),this.fadeProgress=0,this.logo=new Image,this.logo.src="./logo.webp",this.pattern=new Image,this.pattern.src="./raster.webp"}draw(t){if(this.clear(),this.drawLogo(),this.drawGradient(),t){const e=(t-y())/T;if(e<0)return;e>1?this.fadeProgress=1:this.fadeProgress=V(e)}this.fadeProgress&&this.drawVolumeIcon(this.fadeProgress),this.drawHandIcon(this.fadeProgress),this.drawFullScreenIcon(),this.drawPattern()}drawLogo(){const t=w()+.5,e=this.logo.naturalWidth/t,i=this.logo.naturalHeight/t,n=(window.innerWidth-e)/2,s=-50/t;this.ctx.drawImage(this.logo,n,s,e,i)}drawGradient(){this.ctx.save();const t=Math.max(window.innerWidth,window.innerHeight)/2,e=this.ctx.createRadialGradient(t,t,0,t,t,t*Math.sqrt(2));e.addColorStop(0,"transparent"),e.addColorStop(.7,"transparent"),e.addColorStop(.95,"black"),e.addColorStop(1,"black"),this.ctx.fillStyle=e;const i=window.innerHeight/window.innerWidth,n=window.innerWidth/window.innerHeight;this.ctx.setTransform(Math.min(1,n),0,0,Math.min(1,i),0,0),this.ctx.fillRect(0,0,t*2,t*2),this.ctx.restore()}drawHandIcon(t){this.ctx.save(),this.ctx.globalAlpha=1-t,this.ctx.fillStyle="white";const e=5+w();this.ctx.scale(1/e,1/e),this.ctx.translate((window.innerWidth-75)*e/2,window.innerHeight*.85*e),this.ctx.fill(new Path2D("M319 188h-1c-9 0-18 3-24 9-6-15-20-26-36-26-10 0-20 4-27 11-6-13-19-21-34-21-8-1-16 2-22 7V76c0-23-18-41-39-41S98 53 98 76v182l-10-12c-10-11-23-18-37-19-15-1-28 3-39 13l-9 8c-3 2-4 6-2 9l88 169c16 30 46 50 79 50h99v-1c50 0 90-43 90-96V228c0-23-17-40-38-40zm22 135v56c0 44-34 81-75 81h-98c-27 0-52-16-65-42L18 256l5-4a36 36 0 0152 4l25 30a8 8 0 0014-5V76c0-14 10-25 22-25s23 11 23 25v178a8 8 0 0016 0v-54c0-13 10-23 22-23 13 0 23 10 23 24v48a8 8 0 0016 0v-38c0-13 9-24 22-24 12 0 22 11 22 24v36a8 8 0 0016 0v-19c0-14 10-24 22-24h1c12 0 22 10 22 24v95zm0 0")),this.ctx.fill(new Path2D("M73 79c4 0 8-3 8-8a55 55 0 01110 0 8 8 0 0016 0 71 71 0 00-142 0c0 5 3 8 8 8zm0 0")),this.ctx.restore()}drawVolumeIcon(t){this.ctx.save(),this.ctx.globalAlpha=t,this.drawTexts(),this.ctx.save(),this.ctx.fillStyle="white",this.ctx.scale(2,2),this.ctx.translate(24/2,24/2),c.isMuted()?this.ctx.fill(new Path2D("M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z")):this.ctx.fill(new Path2D("M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z")),this.ctx.restore(),this.ctx.restore()}drawFullScreenIcon(){this.ctx.save(),this.ctx.fillStyle="white",this.ctx.scale(2.5,2.5),this.ctx.translate((window.innerWidth-16-R)/2.5,16/2.5),document.fullscreenElement?this.ctx.fill(new Path2D("M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3")):this.ctx.fill(new Path2D("M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z")),this.ctx.restore()}drawTexts(){let t=0,e=0;function i(o){for(const r of o)e=r.height,this.ctx.fillText(r.text.trim(),window.innerWidth/2,window.innerHeight*.65+t+e);t+=e+4}const n=window.innerWidth-40;this.ctx.fillStyle="white",this.ctx.textAlign="center";let s=Math.min(36,window.innerHeight/12);this.ctx.font=`${s}px Verdana`,i.call(this,u(this.ctx,s,F,n)),s=Math.min(27,window.innerHeight/12*.75),this.ctx.font=`${s}px Verdana`,i.call(this,u(this.ctx,s,k,n)),this.ctx.font=`bold ${s}px Verdana`,i.call(this,u(this.ctx,s,N,n))}drawPattern(){this.ctx.save(),this.ctx.fillStyle=this.ctx.createPattern(this.pattern,"repeat"),this.ctx.globalAlpha=.5,this.ctx.fillRect(0,0,window.innerWidth,window.innerHeight),this.ctx.restore()}}const f=new O,C=new D,S=new P(c.analyser),H=new G,d=new W(f,C,S,H),I=a=>{C.draw(),c.isSoundInitialized&&S.draw(),y()&&H.draw(a),window.requestAnimationFrame(I)};window.onload=()=>{window.addEventListener("resize",()=>{L(),d.resizeCanvases(),d.draw()}),window.addEventListener("deviceorientation",t=>{h.handleDeviceOrientation(t),f.draw()}),window.addEventListener("mousemove",t=>{h.handleMouseMove(t),f.draw()}),d.getCanvasElements().at(-1).addEventListener("click",h.handleClick),d.appendToDom(),d.draw(),I()};
